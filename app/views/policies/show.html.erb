<div class="g3">
  <h1 class="page_title has_meta"><%= @policy.title %></h1>
  <nav class="meta">
    <span class="metadata">
      Updated
      <%= render_datetime_microformat(@policy, :updated_at) do %>
        <%= time_ago_in_words(@policy.updated_at) %> ago
      <% end %>
    </span>
    <% @policy.policy_areas.each do |policy_area| %>
      <%= link_to policy_area.name, policy_area_path(policy_area), class: "policy_area" %>
    <% end %>
    <% @policy.organisations.each do |organisation| %>
      <%= link_to organisation.name, organisation_path(organisation), class: "organisation" %>
    <% end %>
    <% @policy.ministerial_roles.each do |ministerial_role| %>
      <%= link_to ministerial_role.current_person_name, ministerial_role, class: "minister" %>
    <% end %>
  </nav>

</div>

<div class="g3f policy_view">

  <div class="g1r">
    <section class="policy_parts">
      <h1>Policy definition</h1>
      <nav class="policy_parts">
        <%= link_to_with_current @policy.title, public_document_path(@policy, anchor: 'policy_view') %>
        <% if govspeak_headers(@policy.body).any? || @related_news_articles.any? || @related_speeches.any? || @related_publications.any? || @related_consultations.any? %>
          <ol id="policy_sections">
            <% govspeak_headers(@policy.body).each do |header| %>
              <li><%= link_to header.text, public_document_path(@policy, anchor: header.id) %></li>
            <% end %>
            <% if @related_news_articles.any? %><li><%= link_to "Related news", public_document_path(@policy, anchor: "related-news-articles") %></li><% end %>
            <% if @related_speeches.any? %><li><%= link_to "Related speeches", public_document_path(@policy, anchor: "related-speeches") %></li><% end %>
            <% if @related_publications.any? %><li><%= link_to "Related publications", public_document_path(@policy, anchor: "related-publications") %></li><% end %>
            <% if @related_consultations.any? %><li><%= link_to "Related consultations", public_document_path(@policy, anchor: "related-consultations") %></li><% end %>
          </ol>
        <% end %>
      </nav>

      <% if (supporting_pages = @policy.supporting_pages).any? %>
        <h2>Supporting detail</h2>
        <nav class="supporting_pages">
          <% supporting_pages.each do |supporting_page| %>
            <%= link_to_with_current supporting_page.title, policy_supporting_page_path(@policy.document_identity, supporting_page) %>
          <% end %>
        </nav>
      <% end %>
    </section>
  </div>

  <div class="g2">
    <%= render partial: 'documents/inapplicable_nations', locals: { document: @policy } %>

    <article class="document">
      <div class="body">
        <%= govspeak_to_html @document.body %>
      </div>
    </article>
  </div>

</div>

<% if @related_news_articles.any? %>
  <div class="g1 related_documents">
    <section id="related-news-articles">
      <h1>Related news</h1>
      <ul>
        <% @related_news_articles.each do |related_document| %>
          <%= content_tag_for :li, related_document do %>
            <%= link_to related_document.title, public_document_path(related_document) %>
          <% end %>
        <% end %>
      </ul>
    </section>
  </div>
<% end %>

<% if @related_speeches.any? %>
  <div class="g1 related_documents">
    <section id="related-speeches">
      <h1>Related speeches</h1>
      <ul>
        <% @related_speeches.each do |speech| %>
          <%= content_tag_for :li, speech do %>
            <%= link_to speech.title, public_document_path(speech) %>
          <% end %>
        <% end %>
      </ul>
    </section>
  </div>
<% end %>

<% if @related_publications.any? %>
  <div class="g1 related_documents">
    <section id="related-publications">
      <h1>Related publications</h1>
      <ul>
        <% @related_publications.each do |related_document| %>
          <%= content_tag_for :li, related_document do %>
            <%= link_to related_document.title, public_document_path(related_document) %>
          <% end %>
        <% end %>
      </ul>
    </section>
  </div>
<% end %>

<% if @related_consultations.any? %>
  <div class="g1 related_documents">
    <section id="related-consultations">
      <h1>Related consultations</h1>
      <ul>
        <% @related_consultations.each do |related_document| %>
          <%= content_tag_for :li, related_document do %>
            <%= link_to related_document.title, public_document_path(related_document) %>
          <% end %>
        <% end %>
      </ul>
    </section>
  </div>
<% end %>

<% if @countries.any? %>
  <div class="g1 related_documents">
    <section id="countries">
      <h1>Related countries</h1>
      <ul>
        <% @countries.each do |country| %>
          <%= content_tag_for :li, country do %>
            <%= link_to country.name, country_path(country) %>
          <% end %>
        <% end %>
      </ul>
    </section>
  </div>
<% end %>

<% if @recently_changed_documents.any? %>
  <div class="g1 related_documents">
    <%= render partial: "documents/recently_changed_documents", object: @recently_changed_documents %>
  </div>
<% end %>

<% unless @related_news_articles.any? || @related_speeches.any? || @related_publications.any? || @related_consultations.any? || @recently_changed_documents.any? %>
  <p class="nothing_related">This policy does not have any related content.</p>
<% end %>
